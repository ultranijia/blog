<!DOCTYPE html><html lang><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 在 “Deploy to Heroku” 之后手动更新Heroku应用 · QIWIHUI</title><meta name="description" content="在 “Deploy to Heroku” 之后手动更新Heroku应用 - qiwihui"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/nella.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-8935595858652656",
enable_page_level_ads: true
});
</script><link rel="search" type="application/opensearchdescription+xml" href="https://qiwihui.com/atom.xml" title="QIWIHUI"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/images/avatar.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/links/" target="_self" class="nav-list-link">LINKS</a></li><!--li.nav-list-item--><!--    a.nav-list-link(class="search" href=url_for("search") target="_self") SEARCH--></ul></header><main class="container"></main><div class="post"><article class="post-block"><h1 class="post-title">在 “Deploy to Heroku” 之后手动更新Heroku应用</h1><div class="post-info">May 5, 2019<span class="categories"><i class="fa fa-bookmark" aria-hidden="true"></i></span><span>4 min. read</span></div><div class="post-content"><p>这个tips以RSSHub为例子。我在Heroku上部署了RSSHub用以日常RSS需求，这个已经部署很久了（2018年11月），准备更新一版，记录如下。</p>
<a id="more"></a>
<ol>
<li>登录Heroku，按照提示进行认证并登录。</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku login</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>获取最新代码，这里我在RSSHub项目目录中进行了拉取（pull）：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> RSSHub</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git pull origin master</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>添加Heroku中项目url，可在 <code>Settings</code> 中 <code>Heroku Git URL</code> 找到：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku git:remote -a rss-qiwihui                       </span></span><br><span class="line">set git remote heroku to https://git.heroku.com/rss-qiwihui.git</span><br></pre></td></tr></table></figure>
<ol start="4">
<li>向Heroku推送，这时Heroku会自动进行部署，结果如下：</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git push heroku master</span></span><br><span class="line">Enumerating objects: 12288, done.</span><br><span class="line">Counting objects: 100% (12288/12288), done.</span><br><span class="line">Delta compression using up to 4 threads</span><br><span class="line">Compressing objects: 100% (3324/3324), done.</span><br><span class="line">Writing objects: 100% (12288/12288), 6.32 MiB | 40.44 MiB/s, done.</span><br><span class="line">Total 12288 (delta 8027), reused 12287 (delta 8026)</span><br><span class="line">remote: Compressing source files... done.</span><br><span class="line">remote: Building source:</span><br><span class="line">remote: </span><br><span class="line">remote: -----&gt; Node.js app detected</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Creating runtime environment</span><br><span class="line">remote:        </span><br><span class="line">remote:        NPM_CONFIG_LOGLEVEL=error</span><br><span class="line">remote:        NODE_ENV=production</span><br><span class="line">remote:        NODE_MODULES_CACHE=true</span><br><span class="line">remote:        NODE_VERBOSE=false</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Installing binaries</span><br><span class="line">remote:        engines.node (package.json):  &gt;=8.0.0</span><br><span class="line">remote:        engines.npm (package.json):   unspecified (use default)</span><br><span class="line">remote:        engines.yarn (package.json):  unspecified (use default)</span><br><span class="line">remote:        </span><br><span class="line">remote:        Resolving node version &gt;=8.0.0...</span><br><span class="line">remote:        Downloading and installing node 12.1.0...</span><br><span class="line">remote:        Using default npm version: 6.9.0</span><br><span class="line">remote:        Resolving yarn version 1.x...</span><br><span class="line">remote:        Downloading and installing yarn (1.16.0)...</span><br><span class="line">remote:        Installed yarn 1.16.0</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Restoring cache</span><br><span class="line">remote:        Cached directories were not restored due to a change in version of node, npm, yarn or stack</span><br><span class="line">remote:        Module installation may take longer for this build</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Installing dependencies</span><br><span class="line">remote:        Installing node modules (yarn.lock)</span><br><span class="line">remote:        yarn install v1.16.0</span><br><span class="line">remote:        [1/4] Resolving packages...</span><br><span class="line">remote:        [2/4] Fetching packages...</span><br><span class="line">remote:        info fsevents@1.2.8: The platform "linux" is incompatible with this module.</span><br><span class="line">remote:        info "fsevents@1.2.8" is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">remote:        [3/4] Linking dependencies...</span><br><span class="line">remote:        [4/4] Building fresh packages...</span><br><span class="line">remote:        Done in 55.40s.</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Build</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Caching build</span><br><span class="line">remote:        - node_modules</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Pruning devDependencies</span><br><span class="line">remote:        yarn install v1.16.0</span><br><span class="line">remote:        [1/4] Resolving packages...</span><br><span class="line">remote:        [2/4] Fetching packages...</span><br><span class="line">remote:        info fsevents@1.2.8: The platform "linux" is incompatible with this module.</span><br><span class="line">remote:        info "fsevents@1.2.8" is an optional dependency and failed compatibility check. Excluding it from installation.</span><br><span class="line">remote:        [3/4] Linking dependencies...</span><br><span class="line">remote:        [4/4] Building fresh packages...</span><br><span class="line">remote:        warning Ignored scripts due to flag.</span><br><span class="line">remote:        Done in 8.07s.</span><br><span class="line">remote:        </span><br><span class="line">remote: -----&gt; Build succeeded!</span><br><span class="line">remote: -----&gt; Discovering process types</span><br><span class="line">remote:        Procfile declares types -&gt; web</span><br><span class="line">remote: </span><br><span class="line">remote: -----&gt; Compressing...</span><br><span class="line">remote:        Done: 143.8M</span><br><span class="line">remote: -----&gt; Launching...</span><br><span class="line">remote:        Released v5</span><br><span class="line">remote:        https://rss-qiwihui.herokuapp.com/ deployed to Heroku</span><br><span class="line">remote: </span><br><span class="line">remote: Verifying deploy... done.</span><br><span class="line">To https://git.heroku.com/rss-qiwihui.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure>
<ol start="5">
<li>设置环境变量 <code>HEROKU_SLUG_COMMIT</code>:</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> heroku config:<span class="built_in">set</span> HEROKU_SLUG_COMMIT=$(git rev-parse --short HEAD)</span></span><br><span class="line">Setting HEROKU_SLUG_COMMIT and restarting ⬢ rss-qiwihui... done, v8</span><br><span class="line"> ▸    Warning: The "HEROKU_" namespace is protected and shouldn't be used.</span><br><span class="line">HEROKU_SLUG_COMMIT: a8066bd</span><br></pre></td></tr></table></figure>
<ol start="6">
<li>验证：</li>
</ol>
<p>前往相应的页面验证，可以看到在Debug中的 githash值已经是当前最新的hash值了。</p>
<p><img src="https://user-images.githubusercontent.com/3297411/57205060-5b873d00-6fee-11e9-893f-14b2978d3b92.png" alt="githash"></p>
</div><p class="post-tags"><i class="fa fa-tags" aria-hidden="true"></i><a href="/tags/tips/">#tips</a><a href="/tags/技术/">#技术</a></p></article></div><div class="post-copyright"><blockquote><p>版权声明：本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">署名-非商业性使用-相同方式共享 | CC BY-NC-SA 4.0 </a>许可协议。</p></blockquote></div><footer><div class="paginator"><a href="/qiwihui-blog-70/" class="prev">PREV</a><a href="/qiwihui-blog-68/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'blog-qiwihui-com';
var disqus_identifier = 'qiwihui-blog-69/';
var disqus_title = '在 “Deploy to Heroku” 之后手动更新Heroku应用';
var disqus_url = 'https://qiwihui.com/qiwihui-blog-69/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//blog-qiwihui-com.disqus.com/count.js" async></script><!-- block copyright--></footer></div><script async src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        processEnvironments: true,
        skipTags: ["script","noscript","style","textarea","code","pre"]
    }
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46660488-3",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script></body></html>